<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>친구 찾기</title>
<link rel="stylesheet" href="/style.css" />
<script src="/js/bootstrap.js"></script>
<style>
  body { background:#000; color:#fff; font-family:-apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo","Noto Sans KR", system-ui, sans-serif; margin:0; }
  .wrap { max-width:480px; margin:0 auto; padding:16px; }
  .row { display:flex; gap:8px; }
  input { flex:1; padding:12px; background:#000; color:#fff; border:1px solid rgba(255,255,255,.14); border-radius:12px; }
  button { padding:12px 16px; border:1px solid rgba(255,255,255,.14); background:transparent; color:#fff; border-radius:12px; }
  .list { margin-top:12px; display:flex; flex-direction:column; gap:8px; }
  .card { display:flex; align-items:center; gap:12px; border:1px solid rgba(255,255,255,.14); border-radius:12px; padding:10px; }
  .avatar { width:40px; height:40px; border-radius:999px; background:#111; object-fit:cover; }
  .name { font-weight:600; }
  .muted { color:rgba(255,255,255,.42); font-size:12px; }
</style>
</head>
<body>
  <div class="wrap">
    <div class="row">
      <input id="q" placeholder="닉네임이나 아이디로 검색" />
      <button id="btn">검색</button>
    </div>
    <div class="list" id="list"></div>
  </div>
<script type="module">
import { API_BASE, AUTH_HEADERS } from "/js/config.js";

const input = document.getElementById('q');
const button = document.getElementById('btn');
const list = document.getElementById('list');

async function safeJson(res) {
  try {
    return await res.json();
  } catch {
    return {};
  }
}

async function search() {
  const q = input.value.trim();
  if (!q) {
    list.innerHTML = '';
    return;
  }
  try {
    const res = await fetch(`${API_BASE}/api/users/search?q=${encodeURIComponent(q)}`, {
      credentials: 'include',
      headers: AUTH_HEADERS(),
    });
    const data = await safeJson(res);
    list.innerHTML = '';
    (data.users || []).forEach((u) => {
      const a = document.createElement('a');
      a.className = 'card';
      a.href = `/profile.html?id=${encodeURIComponent(u.id)}`;
      a.innerHTML = `
        <img class="avatar" src="${u.avatar_url || '/image/avatar-default.png'}" alt="">
        <div>
          <div class="name">${u.nickname || '(닉네임 없음)'}</div>
          <div class="muted">@${u.username}</div>
        </div>
      `;
      list.appendChild(a);
    });
  } catch (err) {
    console.error('search failed', err);
  }
}

button.addEventListener('click', search);
input.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') search();
});
</script>
<script type="module" src="/js/nav.js"></script>

</body>
</html>
